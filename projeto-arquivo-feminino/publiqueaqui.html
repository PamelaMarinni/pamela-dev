<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Publique Aqui ‚Ä¢ Arquivo Feminino: Proibido</title>

  <!-- Fontes e √≠cones (iguais √†s suas p√°ginas) -->
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&family=Roboto&family=Poppins:wght@400;600;700&family=Great+Vibes&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:'Roboto',sans-serif;background:linear-gradient(to right,#F48FB1 0%,#CE93D8 45%,#7E57C2 75%,#42A5F5 100%);color:#fff}

    /* HEADER (ID√äNTICO ao seu) */
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:1.5rem 4vw;background:rgba(0,0,0,.25);box-shadow:0 4px 20px rgba(0,0,0,.4);gap:1rem}
    .titulo{ font-family: 'Great Vibes',cursive;font-size:2.2rem;margin:0;text-shadow:2px 2px 4px rgba(123,31,162,.8),0 0 10px rgba(233,30,99,.8)}
    nav a{text-decoration:none;color:#fff;font-size:1.3rem;margin:0 .5rem}

    /* WRAP */
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}

    /* HERO */
    .hero{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:16px 18px;box-shadow:0 6px 16px rgba(0,0,0,.25);text-align:center}
    .hero h2{margin:0;font-size:2.1rem;color:#FFD966;font-weight:400}
    .hero p{margin:6px 0 0;color:#f7d3e6}

    /* FORM */
    .form-card{margin-top:18px;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:16px;box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .sec-title{margin:0 0 10px 0;font-weight:800;color:#FFD966}
    .grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .grid-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
    label{font-weight:700;font-size:.95rem;margin-top:4px;display:block}
    input,select,textarea{
      width:100%;background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.25);
      border-radius:10px;padding:10px;color:#fff
    }
    textarea{min-height:110px;resize:vertical}
    .hint{font-size:.85rem;color:#f7d3e6;opacity:.9}

    .btn{background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.25);color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(135deg,#845EC2,#D65DB1);border-color:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* TAGS */
    .tags{display:flex;flex-wrap:wrap;gap:8px}
    .tag{display:flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.35);padding:6px 10px;border-radius:999px}
    .tag input{width:auto}

    /* PREVIEW CAPA & GALERIA */
    .capas{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .capa-preview{width:120px;height:160px;border-radius:12px;border:1px solid rgba(255,255,255,.25);object-fit:cover;background:rgba(255,255,255,.08)}
    .previews{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .thumb{width:90px;height:120px;border-radius:10px;border:1px solid rgba(255,255,255,.25);object-fit:cover;box-shadow:0 6px 12px rgba(0,0,0,.25)}

    /* FILTROS + LISTA */
    .filters{margin-top:22px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .lista{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin-top:16px}
    .card{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:12px;box-shadow:0 6px 16px rgba(0,0,0,.25);display:flex;flex-direction:column;gap:10px}
    .linha{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .pill{display:inline-block;border:1px solid rgba(255,255,255,.28);padding:4px 8px;border-radius:999px;font-size:.82rem;background:rgba(0,0,0,.25)}
    .chip{border:1px solid rgba(255,255,255,.45);padding:6px 10px;border-radius:999px}
    .acoes{display:flex;gap:8px;flex-wrap:wrap}
    .mini-capa{width:85px;height:115px;border-radius:10px;border:1px solid rgba(255,255,255,.18);object-fit:cover}

    /* MODAL LEITURA */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000}
    .modal.active{display:flex}
    .modal-box{background:rgba(0,0,0,.9);border:1px solid rgba(255,255,255,.18);color:#fff;max-width:820px;width:100%;max-height:85vh;overflow:auto;border-radius:16px;padding:16px}
    .modal h3{margin-top:0}
    .read{line-height:1.6;letter-spacing:.2px}

    /* FOOTER (ID√äNTICO) */
    .rodape{background:#5a2a46;color:#e6d6e8;font-size:.9rem;padding:16px 0;border-top:.5px solid #7a4f9a;display:flex;justify-content:center;align-items:center;margin-top:28px}
    .container-rodape{max-width:1100px;padding:0 16px;text-align:center}
    .florzinha{font-size:1.4rem;color:#d4a1e8}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <h1 class="titulo">Arquivo Feminino: Proibido</h1>
    <nav>
      <a href="index.html" title="In√≠cio">üè†</a>
      <a href="favoritos.html" title="Favoritos">ü§ç</a>
      <a href="pedidos.html" title="Pedidos">üõí</a>
      <a href="contato.html" title="Contato">üìû</a>
    </nav>
  </header>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero">
      <h2><span style="font-family:'Great Vibes',cursive">Publique Aqui</span></h2>
      <p>Coloque seu livro aqui para publica√ß√£o ‚ú® (os dados ficam salvos no seu navegador)</p>
    </section>

    <!-- FORMUL√ÅRIO -->
    <section class="form-card" aria-label="Formul√°rio de publica√ß√£o">
      <h3 class="sec-title">Informa√ß√µes do livro</h3>
      <form id="formPub">
        <div class="grid-2">
          <div>
            <label for="titulo">T√≠tulo *</label>
            <input id="titulo" required placeholder="Ex.: A Porta Sem Nome">
          </div>
          <div>
            <label for="autor">Autora/Autor *</label>
            <input id="autor" required placeholder="Ex.: Helena L. Ruiz">
          </div>
        </div>

        <div class="grid-3" style="margin-top:8px">
          <div>
            <label for="genero">G√™nero *</label>
            <select id="genero" required>
              <option value="">Selecione‚Ä¶</option>
              <option>Romance</option>
              <option>Fantasia</option>
              <option>Suspense/Thriller</option>
              <option>Poesia</option>
              <option>Cr√¥nicas</option>
              <option>Ensaio</option>
              <option>Outro</option>
            </select>
          </div>
          <div>
            <label for="indicativo">P√∫blico/Indicativo</label>
            <select id="indicativo">
              <option value="">Livre</option>
              <option>12+</option>
              <option>16+</option>
              <option>18+</option>
            </select>
          </div>
          <div>
            <label for="contato">Contato (WhatsApp ou e-mail)</label>
            <input id="contato" placeholder="Ex.: (11) 9 9999-0000 ou nome@email.com">
          </div>
        </div>

        <div style="margin-top:8px">
          <label for="sinopse">Sinopse breve (m√°x. 500)</label>
          <textarea id="sinopse" maxlength="500" placeholder="Conte rapidamente sobre sua hist√≥ria..."></textarea>
          <div class="hint"><span id="countSinopse">0</span>/500</div>
        </div>

        <div style="margin-top:10px">
          <label>Tags (opcional)</label>
          <div class="tags">
            <label class="tag"><input type="checkbox" value="for√ßa feminina"> for√ßa feminina</label>
            <label class="tag"><input type="checkbox" value="romance hist√≥rico"> romance hist√≥rico</label>
            <label class="tag"><input type="checkbox" value="dark/psicol√≥gico"> dark/psicol√≥gico</label>
            <label class="tag"><input type="checkbox" value="poesia"> poesia</label>
            <label class="tag"><input type="checkbox" value="autocuidado"> autocuidado</label>
            <label class="tag"><input type="checkbox" value="fantasia rom√¢ntica"> fantasia rom√¢ntica</label>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,.15);margin:16px 0">

        <h3 class="sec-title">Arquivos & m√≠dia</h3>
        <div class="grid-2">
          <div>
            <label for="capa">Capa (JPG/PNG at√© 2MB)</label>
            <div class="capas">
              <input id="capa" type="file" accept="image/*">
              <img id="capaPreview" class="capa-preview" alt="Pr√©via da capa">
            </div>
            <div class="hint">Dica: use uma imagem vertical ~600√ó800px.</div>
          </div>
          <div>
            <label for="pdf">Amostra em PDF (at√© 2MB, opcional)</label>
            <input id="pdf" type="file" accept="application/pdf">
            <div class="hint" id="pdfInfo">Nenhum arquivo selecionado.</div>
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="imagens">Imagens adicionais (at√© 6, 400KB cada)</label>
          <input id="imagens" type="file" accept="image/*" multiple>
          <div class="hint">As imagens ficam salvas localmente (sem envio para servidor).</div>
          <div id="previews" class="previews"></div>
        </div>

        <div style="margin-top:10px">
          <label for="cap1">Cap√≠tulo 1 (texto, opcional)</label>
          <textarea id="cap1" placeholder="Cole seu Cap√≠tulo 1 aqui... (m√°x. ~10.000 caracteres)"></textarea>
          <div class="hint">Se preferir, envie apenas o PDF acima.</div>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,.15);margin:16px 0">

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <button class="btn" type="button" id="btnRascunho">Salvar rascunho</button>
          <button class="btn primary" type="submit" id="btnPublicar">Publicar</button>
          <button class="btn" type="reset" id="btnLimpar">Limpar</button>
          <span class="pill" id="statusRascunho" aria-live="polite">Sem rascunho</span>
        </div>
      </form>
    </section>

   <section class="lista" id="listaPublicados" aria-label="Meus publicados"></section>

    <!-- Voltar -->
    <div style="text-align:center;margin:22px 0 6px">
      <a href="index.html" class="btn primary" style="font-family:'Great Vibes',cursive;font-size:1.2rem;padding:10px 20px;border-radius:30px;text-decoration:none;display:inline-block;">P√°gina Inicial</a>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="rodape">
    <div class="container-rodape">
    <p><span class="florzinha">‚úø</span> Criado e mantido por Pamela Marini <span class="florzinha">‚úø</span></p>
   </div>
  </footer>

  <!-- MODAL LEITURA -->
  <div class="modal" id="modal">
    <div class="modal-box">
      <div class="linha">
        <h3 id="modalTitulo">Amostra de leitura</h3>
        <button class="btn" id="modalClose">Fechar</button>
      </div>
      <div id="modalBody" class="read"></div>
    </div>
  </div>

  <script>
    /* ================== CONFIG / LIMITES ================== */
    const MAX_IMG = 6;
    const MAX_IMG_SIZE = 400 * 1024; // 400KB
    const MAX_CAPA_SIZE = 2 * 1024 * 1024; // 2MB
    const MAX_PDF_SIZE = 2 * 1024 * 1024; // 2MB

    /* ================== STORAGE ================== */
    const DB_KEY = 'publique_v1_items';
    const DRAFT_KEY = 'publique_v1_draft';

    const LS = {
      get(k, def){ try { return JSON.parse(localStorage.getItem(k)) ?? def } catch(e){ return def } },
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)); },
      del(k){ localStorage.removeItem(k); }
    };

    /* ================== HELPERS ================== */
    const $ = (s,el=document)=> el.querySelector(s);
    const $$ = (s,el=document)=> Array.from(el.querySelectorAll(s));

    function toast(msg){
      let r = $('#toast-root');
      if(!r){ r = document.createElement('div'); r.id='toast-root';
        Object.assign(r.style,{position:'fixed',right:'16px',bottom:'16px',display:'flex',gap:'10px',flexDirection:'column',zIndex:9999});
        document.body.appendChild(r);
      }
      const el = document.createElement('div'); el.textContent = msg;
      Object.assign(el.style,{background:'rgba(0,0,0,.85)',color:'#fff',padding:'10px 12px',borderRadius:'12px',boxShadow:'0 10px 24px rgba(0,0,0,.25)'});
      r.appendChild(el); setTimeout(()=> el.remove(), 2400);
    }

    function fileToDataURL(file){
      return new Promise((resolve, reject)=>{
        const fr = new FileReader();
        fr.onload = e => resolve(e.target.result);
        fr.onerror = reject;
        fr.readAsDataURL(file);
      });
    }

    function getTagsSelected(){
      return $$('.tags input:checked').map(x=>x.value);
    }

    function setTagsSelected(tags){
      $$('.tags input').forEach(x=> x.checked = tags?.includes(x.value));
    }

    function slugify(str){
      return (str||'').toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
    }

    /* ================== ELEMENTOS ================== */
    const form = $('#formPub');
    const titulo = $('#titulo');
    const autor = $('#autor');
    const genero = $('#genero');
    const indicativo = $('#indicativo');
    const contato = $('#contato');
    const sinopse = $('#sinopse');
    const cap1 = $('#cap1');

    const capa = $('#capa');
    const capaPreview = $('#capaPreview');

    const pdf = $('#pdf');
    const pdfInfo = $('#pdfInfo');

    const imagens = $('#imagens');
    const previews = $('#previews');

    const btnRascunho = $('#btnRascunho');
    const statusRascunho = $('#statusRascunho');

    const fGenero = $('#fGenero');
    const fBusca = $('#fBusca');
    const lista = $('#listaPublicados');

    const modal = $('#modal');
    const modalBody = $('#modalBody');
    const modalTitulo = $('#modalTitulo');
    $('#modalClose').addEventListener('click', ()=> modal.classList.remove('active'));
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('active'); });

    /* ================== CONTADORES ================== */
    const countSinopse = $('#countSinopse');
    sinopse.addEventListener('input', ()=> countSinopse.textContent = sinopse.value.length);

    /* ================== PREVIEW CAPA ================== */
    capa.addEventListener('change', async ()=>{
      const f = capa.files?.[0];
      if(!f){ capaPreview.src=''; return; }
      if(f.size > MAX_CAPA_SIZE){ toast('Capa acima de 2MB. Escolha outra.'); capa.value=''; return; }
      capaPreview.src = await fileToDataURL(f);
    });

    /* ================== PDF INFO ================== */
    pdf.addEventListener('change', ()=>{
      const f = pdf.files?.[0];
      if(!f){ pdfInfo.textContent='Nenhum arquivo selecionado.'; return; }
      if(f.size > MAX_PDF_SIZE){ toast('PDF acima de 2MB. Escolha outro.'); pdf.value=''; pdfInfo.textContent='Nenhum arquivo selecionado.'; return; }
      pdfInfo.textContent = 'Selecionado: ' + f.name + ` (${Math.round(f.size/1024)} KB)`;
    });

    /* ================== IMAGENS ADICIONAIS ================== */
    imagens.addEventListener('change', async ()=>{
      previews.innerHTML = '';
      let files = Array.from(imagens.files||[]);
      if(files.length > MAX_IMG){ toast('M√°ximo de 6 imagens.'); files = files.slice(0, MAX_IMG); }

      for(const f of files){
        if(f.size > MAX_IMG_SIZE){ toast(`Imagem ${f.name} acima de 400KB ‚Äî ignorada.`); continue; }
        const url = await fileToDataURL(f);
        const img = new Image(); img.src = url; img.className='thumb';
        previews.appendChild(img);
      }
    });

    /* ================== RASCUNHO ================== */
    function getDraft(){
      return LS.get(DRAFT_KEY, null);
    }
    function saveDraft(){
      const draft = {
        titulo: titulo.value.trim(),
        autor: autor.value.trim(),
        genero: genero.value,
        indicativo: indicativo.value,
        contato: contato.value.trim(),
        sinopse: sinopse.value,
        cap1: cap1.value,
        tags: getTagsSelected(),
        capa: capaPreview.src || '',
        pdfName: pdf.files?.[0]?.name || '',
        pdfData: null, // s√≥ salva no publicar (para n√£o pesar o rascunho)
        imagens: Array.from(previews.querySelectorAll('img')).map(i=> i.src),
        quando: new Date().toISOString()
      };
      LS.set(DRAFT_KEY, draft);
      statusRascunho.textContent = 'Rascunho salvo √†s ' + new Date().toLocaleTimeString();
      toast('Rascunho salvo üíæ');
    }
    function loadDraft(){
      const d = getDraft(); if(!d) return;
      titulo.value = d.titulo||''; autor.value = d.autor||'';
      genero.value = d.genero||''; indicativo.value = d.indicativo||'';
      contato.value = d.contato||''; sinopse.value = d.sinopse||'';
      cap1.value = d.cap1||''; countSinopse.textContent = (d.sinopse||'').length;
      setTagsSelected(d.tags||[]);
      capaPreview.src = d.capa||'';
      previews.innerHTML = '';
      (d.imagens||[]).forEach(src=>{ const img = new Image(); img.src=src; img.className='thumb'; previews.appendChild(img); });
      statusRascunho.textContent = 'Rascunho carregado';
    }
    btnRascunho.addEventListener('click', saveDraft);

    /* ================== PUBLICAR ================== */
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = $('#btnPublicar'); btn.disabled = true;

      if(!titulo.value.trim() || !autor.value.trim() || !genero.value){
        toast('Preencha t√≠tulo, autor e g√™nero.'); btn.disabled=false; return;
      }

      // pega dados do formul√°rio
      const item = {
        id: 'p'+Date.now()+Math.random().toString(16).slice(2),
        titulo: titulo.value.trim(),
        autor: autor.value.trim(),
        genero: genero.value,
        indicativo: indicativo.value,
        contato: contato.value.trim(),
        sinopse: sinopse.value.trim(),
        cap1: cap1.value.trim(),
        tags: getTagsSelected(),
        capa: capaPreview.src || '',
        pdfName: '',
        pdfData: '',
        imagens: Array.from(previews.querySelectorAll('img')).map(i=> i.src),
        slug: slugify(titulo.value.trim() + '-' + autor.value.trim()),
        quando: new Date().toISOString()
      };

      // PDF opcional (guarda como dataURL com limite)
      const pdfFile = pdf.files?.[0];
      if(pdfFile){
        if(pdfFile.size > MAX_PDF_SIZE){
          toast('PDF acima de 2MB. N√£o foi anexado.'); 
        }else{
          item.pdfName = pdfFile.name;
          item.pdfData = await fileToDataURL(pdfFile);
        }
      }

      // salva no DB (localStorage)
      const db = LS.get(DB_KEY, []);
      db.push(item); LS.set(DB_KEY, db);

      // limpa rascunho
      LS.del(DRAFT_KEY);
      statusRascunho.textContent = 'Sem rascunho';

      // limpa formul√°rio
      form.reset(); capaPreview.src=''; previews.innerHTML=''; pdfInfo.textContent='Nenhum arquivo selecionado.';
      countSinopse.textContent = '0';

      toast('Publicado com sucesso ‚ú®');
      renderList();
      btn.disabled=false;
      window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});
    });

    $('#btnLimpar').addEventListener('click', ()=>{
      LS.del(DRAFT_KEY);
      statusRascunho.textContent = 'Sem rascunho';
      capaPreview.src=''; previews.innerHTML=''; pdfInfo.textContent='Nenhum arquivo selecionado.';
      countSinopse.textContent = '0';
    });

    /* ================== LISTA & FILTROS ================== */
    fGenero.addEventListener('change', renderList);
    fBusca.addEventListener('input', renderList);

    function renderList(){
      const db = LS.get(DB_KEY, []).slice().reverse();
      const gen = fGenero.value || 'todos';
      const q = (fBusca.value||'').toLowerCase();

      let items = db;
      if(gen!=='todos') items = items.filter(i=> i.genero === gen);
      if(q) items = items.filter(i=> 
        i.titulo.toLowerCase().includes(q) ||
        i.autor.toLowerCase().includes(q) ||
        (i.sinopse||'').toLowerCase().includes(q) ||
        (i.tags||[]).some(t=> t.toLowerCase().includes(q))
      );

      lista.innerHTML = '';
      if(items.length===0){
        lista.innerHTML = `<p class="pill" style="grid-column:1/-1">Nenhuma publica√ß√£o ainda. Publique acima ‚ú®</p>`;
        return;
      }

      for(const it of items){
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <div class="linha">
            <div style="display:flex;gap:10px;align-items:center">
              <img src="${it.capa||''}" class="mini-capa" alt="Capa">
              <div>
                <h3 style="margin:0">${it.titulo}</h3>
                <p style="margin:0;opacity:.9">${it.autor}</p>
                <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px">
                  <span class="pill">${it.genero}</span>
                  ${it.indicativo?`<span class="pill">${it.indicativo}</span>`:''}
                  ${it.pdfData?`<span class="pill">PDF</span>`:''}
                  ${(it.tags||[]).slice(0,3).map(t=>`<span class="chip">${t}</span>`).join('')}
                </div>
              </div>
            </div>
            <span class="pill" title="${new Date(it.quando).toLocaleString()}">${new Date(it.quando).toLocaleDateString()}</span>
          </div>
          <p style="margin:0">${it.sinopse||''}</p>
          <div class="acoes">
            ${it.cap1 ? `<button class="btn" data-read="${it.id}">Ler amostra</button>` : (it.pdfData ? `<button class="btn" data-pdf="${it.id}">Abrir PDF</button>` : '')}
            <button class="btn" data-share="${it.id}">WhatsApp</button>
            <button class="btn" data-edit="${it.id}">Editar</button>
            <button class="btn" data-remove="${it.id}">Remover</button>
          </div>
        `;
        lista.appendChild(card);
      }

      // a√ß√µes
      lista.querySelectorAll('[data-read]').forEach(b=>{
        b.addEventListener('click', ()=> openRead(b.dataset.read));
      });
      lista.querySelectorAll('[data-pdf]').forEach(b=>{
        b.addEventListener('click', ()=> openPDF(b.dataset.pdf));
      });
      lista.querySelectorAll('[data-share]').forEach(b=>{
        b.addEventListener('click', ()=> shareWA(b.dataset.share));
      });
      lista.querySelectorAll('[data-edit]').forEach(b=>{
        b.addEventListener('click', ()=> editItem(b.dataset.edit));
      });
      lista.querySelectorAll('[data-remove]').forEach(b=>{
        b.addEventListener('click', ()=> removeItem(b.dataset.remove));
      });
    }

    function openRead(id){
      const db = LS.get(DB_KEY, []);
      const it = db.find(x=> x.id===id);
      if(!it) return;
      modalTitulo.textContent = `Amostra ‚Äî ${it.titulo}`;
      modalBody.innerHTML = `<h4>Cap√≠tulo 1</h4><div>${(it.cap1||'').replace(/\n/g,'<br>')}</div>`;
      modal.classList.add('active');
    }

    function openPDF(id){
      const db = LS.get(DB_KEY, []);
      const it = db.find(x=> x.id===id);
      if(!it || !it.pdfData){ toast('PDF n√£o encontrado.'); return; }
      const a = document.createElement('a');
      a.href = it.pdfData;
      a.download = it.pdfName || 'amostra.pdf';
      a.target = '_blank';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function shareWA(id){
      const db = LS.get(DB_KEY, []);
      const it = db.find(x=> x.id===id);
      if(!it) return;
      const link = location.origin + location.pathname + '#pub=' + it.slug;
      const msg = `üìö *${it.titulo}* ‚Äî ${it.autor}\n` +
                  `${it.sinopse?('\n'+it.sinopse.substring(0,180)+'‚Ä¶\n'):''}`+
                  `G√™nero: ${it.genero}${it.indicativo? ' ‚Ä¢ '+it.indicativo : ''}\n`+
                  `Link: ${link}\n\n`+
                  (it.contato?`Contato: ${it.contato}\n`:'')+
                  `Vem ler minha amostra! ‚ú®`;
      window.open('https://wa.me/?text='+encodeURIComponent(msg),'_blank');
    }

    function editItem(id){
      const db = LS.get(DB_KEY, []);
      const it = db.find(x=> x.id===id);
      if(!it) return;

      // joga para rascunho e preenche o form
      LS.set(DRAFT_KEY, {...it, pdfData: null}); // n√£o recoloca o PDF no rascunho para poupar espa√ßo
      loadDraft();
      // remove item antigo (vai ser republicado ao enviar)
      const novo = db.filter(x=> x.id!==id); LS.set(DB_KEY, novo);
      renderList();
      window.scrollTo({top: 0, behavior:'smooth'});
      toast('Carregado para edi√ß√£o (salvo como rascunho)');
    }

    function removeItem(id){
      const db = LS.get(DB_KEY, []);
      const novo = db.filter(x=> x.id!==id); LS.set(DB_KEY, novo);
      renderList();
      toast('Removido');
    }

    /* ================== DEEP LINK (#pub=slug) ================== */
    function checkHash(){
      const m = location.hash.match(/#pub=([^&]+)/);
      if(!m) return;
      const slug = decodeURIComponent(m[1]);
      const db = LS.get(DB_KEY, []);
      const it = db.find(x=> x.slug===slug);
      if(!it) return;
      fBusca.value = it.titulo;
      renderList();
      // destaca
      const card = Array.from(document.querySelectorAll('.card')).find(el => el.innerText.includes(it.titulo));
      if(card){ card.style.outline='2px solid #FFD966'; card.scrollIntoView({behavior:'smooth', block:'center'}); setTimeout(()=> card.style.outline='none', 2000); }
    }

    /* ================== START ================== */
    function init(){
      loadDraft();
      renderList();
      checkHash();
      countSinopse.textContent = sinopse.value.length;
    }
    init();
  </script>
</body>
</html>