<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Livro</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Parisienne&family=Great+Vibes&family=Roboto&display=swap');
    *{box-sizing:border-box}
    body,html{margin:0;padding:0;font-family:'Roboto',sans-serif;background:linear-gradient(90deg,#F48FB1,#7E57C8,#42A5F5);color:white}

    /* HEADER padronizado */
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:1.5rem 4vw;background:rgba(0,0,0,.25);box-shadow:0 4px 20px rgba(0,0,0,.4);gap:1rem}
    .titulo-site{font-family:'Great Vibes',cursive;font-size:2.2rem;margin:0;text-shadow:2px 2px 4px rgba(123,31,162,.8),0 0 10px rgba(233,30,99,.8)}
    nav a{text-decoration:none;color:#fff;font-size:1.3rem;margin:0 .5rem}

    /* Conte√∫do do livro */
    .layout{display:flex;justify-content:center;align-items:flex-start;padding:40px;gap:60px;max-width:1000px;margin:0 auto;flex-wrap:wrap}
    .imagens{position:relative;display:flex;flex-direction:column;align-items:center;gap:15px;flex-shrink:0}
    .imagem-grande{width:400px;height:600px;border-radius:12px;object-fit:cover;background-color:transparent;display:block}
    .detalhes{max-width:450px;display:flex;flex-direction:column;gap:15px;flex-grow:1}
    .miniaturas{display:flex;gap:10px}
    .miniatura{width:60px;height:60px;border-radius:8px;object-fit:cover;opacity:.5;cursor:pointer;transition:.3s;background-color:white}
    .miniatura.ativa,.miniatura:hover{opacity:1;box-shadow:0 0 6px white}
    .seta{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.2);border:none;font-size:2rem;padding:6px 12px;color:white;cursor:pointer;border-radius:50%;user-select:none}
    .seta.esquerda{left:-30px}.seta.direita{right:-30px}
    .detalhes h1{font-family:'Parisienne',cursive;font-size:3rem;margin:0;color:#FFC75F}
    .preco{font-size:1.8rem;font-weight:bold;color:#FF9671}
    .parcelamento{font-size:1rem;color:#FFD1DC}
    .avaliacao{font-size:1.3rem;color:#FFD1DC}
    .descricao{font-size:1.1rem;line-height:1.6}
    .botoes{display:flex;gap:15px;margin-top:10px}
    .botoes button{flex:1;padding:12px;font-size:1.2rem;font-weight:bold;background:rgba(126,87,194,.7);color:white;border:none;border-radius:10px;cursor:pointer;transition:background .3s}
    .botoes button:hover{background:rgba(126,87,194,.9)}
    .compartilhar{display:flex;gap:15px;margin-top:15px}
    .compartilhar svg{width:26px;height:26px;fill:white;cursor:pointer;transition:fill .3s}
    .compartilhar svg:hover{fill:#FFC75F}
    .acoes{display:flex;align-items:center;gap:20px;margin-top:20px}
    .botao-comprar{background-color:#FF6F91;color:white;font-size:1.1rem;font-weight:bold;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;transition:background .3s ease}
    .botao-comprar:hover{background-color:#ff4f78}
    .icone{font-size:1.8rem;cursor:pointer;transition:transform .2s}
    .icone:hover{transform:scale(1.2)}
    .descricao-longa{max-width:1000px;margin:30px auto 60px auto;background:rgba(255,255,255,.1);padding:20px 30px;border-radius:10px;color:white;font-size:1.1rem;line-height:1.6;box-sizing:border-box}
    .info-livro{display:flex;flex-wrap:wrap;gap:25px;margin-top:25px;margin-bottom:50px;color:white;font-size:1rem;align-items:center;justify-content:center}
    .item-info{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.15);padding:8px 14px;border-radius:12px;min-width:140px;justify-content:center;user-select:none;cursor:default;transition:background .3s ease}
    .info-livro-container{display:flex;justify-content:center;margin:40px auto 20px auto;padding:0 20px}
    .item-info:hover{background:rgba(255,255,255,.3)}
    .icone-info{width:22px;height:22px;fill:#FFC75F}

    /* Bot√£o voltar */
    .botao-voltar-container{text-align:center;margin:0 auto 24px}
    .botao-voltar{font-family:'Great Vibes',cursive;background:linear-gradient(135deg,#845EC2,#D65DB1);color:#fff;padding:14px 28px;font-size:1.5rem;font-weight:500;border:0;border-radius:30px;text-decoration:none;display:inline-block;box-shadow:0 6px 12px rgba(132,94,194,.3);transition:transform .2s ease,box-shadow .3s ease}
    .botao-voltar:hover{transform:scale(1.05);box-shadow:0 8px 16px rgba(132,94,194,.4)}

    /* Rodap√© */
    .rodape{background-color:#5a2a46;color:#e6d6e8;font-size:.9rem;padding:16px 0;border-top:.5px solid #7a4f9a;width:100%;box-sizing:border-box;position:relative;user-select:none;font-family:'Poppins',sans-serif;display:flex;justify-content:center;align-items:center;margin:0}
    .container-rodape{max-width:1100px;width:100%;padding:0 16px;box-sizing:border-box;text-align:center}
    .container-rodape p{margin:0}
    .florzinha{font-size:1.4rem;line-height:1;color:#d4a1e8}
  </style>
</head>
<body>

  <!-- HEADER padronizado -->
  <header>
    <h1 class="titulo-site">Arquivo Feminino: Proibido</h1>
    <nav>
      <a href="index.html" title="In√≠cio">üè†</a>
      <a href="favoritos.html" title="Favoritos">ü§ç</a>
      <a href="pedidos.html" title="Pedidos">üõí</a>
      <a href="contato.html" title="Contato">üìû</a>
    </nav>
  </header>

  <main>
    <div class="layout">
      <div class="imagens">
        <button class="seta esquerda" onclick="trocarImagem(-1)">‚ùÆ</button>
        <img id="imagem-grande" class="imagem-grande" src="" alt="">
        <button class="seta direita" onclick="trocarImagem(1)">‚ùØ</button>
        <div class="miniaturas" id="miniaturas"></div>
      </div>

      <div class="detalhes">
        <h1 id="titulo"></h1>
        <div class="preco" id="preco"></div>
        <div class="parcelamento" id="parcelamento"></div>
        <div class="avaliacao" id="avaliacao"></div>
        <div class="descricao" id="descricaoCurta"></div>

        <!-- Compartilhar (√≠cones vis√≠veis; hrefs s√£o definidos via JS) -->
        <div class="compartilhar" aria-label="Compartilhar nas redes sociais" id="shareBox">
          <!-- WhatsApp -->
          <a id="shareWhats" aria-label="Compartilhar no WhatsApp" target="_blank" rel="noopener noreferrer">
            <!-- SVG WhatsApp -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.52 3.48a11.64 11.64 0 00-16.44 0 11.6 11.6 0 00-3.4 8.2c0 2.14.54 4.16 1.57 5.97L2 22l4.34-1.14a11.58 11.58 0 005.97 1.57 11.6 11.6 0 008.2-3.4 11.64 11.64 0 000-16.44z"/></svg>
          </a>

          <!-- Facebook -->
          <a id="shareFace" aria-label="Compartilhar no Facebook" target="_blank" rel="noopener noreferrer">
            <!-- SVG Facebook -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 10-11.5 9.9v-7H8v-3h2.5V9.5c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.3.2 2.3.2v2.5h-1.3c-1.3 0-1.7.8-1.7 1.6V12H18l-.5 3h-2.5v7A10 10 0 0022 12z"/></svg>
          </a>

          <!-- Instagram (sem share por URL; abre Instagram) -->
          <a id="shareInsta" aria-label="Abrir Instagram" target="_blank" rel="noopener noreferrer">
            <!-- SVG Instagram -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.75 2h8.5A5.75 5.75 0 0122 7.75v8.5A5.75 5.75 0 0116.25 22h-8.5A5.75 5.75 0 012 16.25v-8.5A5.75 5.75 0 017.75 2zm0 1.5A4.25 4.25 0 003.5 7.75v8.5A4.25 4.25 0 007.75 20.5h8.5a4.25 4.25 0 004.25-4.25v-8.5A4.25 4.25 0 0016.25 3.5h-8.5zm8.5 2a1 1 0 110 2 1 1 0 010-2zm-4.25 2.25a4.75 4.75 0 110 9.5 4.75 4.75 0 010-9.5zm0 1.5a3.25 3.25 0 100 6.5 3.25 3.25 0 000-6.5z"/></svg>
          </a>
        </div>

        <div class="acoes">
          <button class="botao-comprar" id="btnComprar">Comprar</button>
          <span class="icone" id="btnFav"  data-fav-btn  aria-label="Adicionar aos favoritos">ü§ç</span>
          <span class="icone" id="btnCart" data-cart-btn aria-label="Adicionar aos pedidos">üõí</span>
        </div>
      </div>
    </div>

    <div class="descricao-longa">
      <h2>Sobre o livro</h2>
      <p id="descricaoLonga"></p>
    </div>

    <section class="info-livro-container">
      <div class="info-livro" id="infoLivro"></div>
    </section>

    <!-- Bot√£o voltar -->
    <div class="botao-voltar-container">
      <a href="index.html" class="botao-voltar">P√°gina Inicial</a>
    </div>
  </main>

  <footer class="rodape">
    <div class="container-rodape">
  <p><span class="florzinha">‚úø</span> Criado e mantido por P√¢mela Marini <span class="florzinha">‚úø</span></p>
   </div>
  </footer>

  <!-- Importa os dados UMA vez -->
  <script src="livros.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ========= CARREGA DADOS DO LIVRO =========
    const urlParams = new URLSearchParams(window.location.search);
    const livroId = urlParams.get('id');
    const livro = (window.livros && window.livros[livroId]) || null;

    if (!livro) {
      document.body.innerHTML = "<h1 style='text-align:center;color:white;'>Livro n√£o encontrado</h1>";
      return;
    }

    // Preenche cabe√ßalho
    titulo.textContent         = livro.titulo || '';
    preco.textContent          = livro.preco || '';
    parcelamento.textContent   = livro.parcelamento || '';
    avaliacao.textContent      = livro.avaliacao || '';
    descricaoCurta.textContent = livro.descricaoCurta || '';
    descricaoLonga.textContent = livro.descricaoLonga || '';

    // ========= Compartilhar (gera hrefs din√¢micos) =========
    const shareBox  = document.getElementById('shareBox');
    const linkWpp   = document.getElementById('shareWhats');
    const linkFace  = document.getElementById('shareFace');
    const linkInsta = document.getElementById('shareInsta');

    if (shareBox) {
      shareBox.addEventListener('click', (e) => e.stopPropagation()); // n√£o aciona links de card
    }

    // Gera URL da p√°gina com o id garantido
    const pageUrl = new URL(window.location.href);
    pageUrl.searchParams.set('id', livroId);

    const texto = `Olha este livro: ${livro.titulo} ‚Äî `;

    if (linkWpp) {
      linkWpp.href = `https://api.whatsapp.com/send?text=${encodeURIComponent(texto + pageUrl.href)}`;
    }
    if (linkFace) {
      linkFace.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl.href)}`;
    }
    if (linkInsta) {
      linkInsta.href = 'https://www.instagram.com/';
    }

    // ========= GALERIA =========
    let atual = 0;
    const galeria = Array.isArray(livro.imagens) ? livro.imagens.filter(Boolean) : (livro.imagem ? [livro.imagem] : []);
    const imagemGrande = document.getElementById('imagem-grande');
    const miniaturasDiv = document.getElementById('miniaturas');

    function atualizarImagem() {
      if (!galeria.length) {
        imagemGrande.removeAttribute('src');
        imagemGrande.alt = 'Sem imagem';
        imagemGrande.style.display = 'none';
        miniaturasDiv.innerHTML = '';
        return;
      }
      imagemGrande.style.display = 'block';
      imagemGrande.src = galeria[atual];
      imagemGrande.alt = livro.titulo || '';
      [...miniaturasDiv.children].forEach((m,i)=>m.classList.toggle('ativa', i===atual));
    }
    window.trocarImagem = function(dir) {
      if (!galeria.length) return;
      atual = (atual + dir + galeria.length) % galeria.length;
      atualizarImagem();
    };

    miniaturasDiv.innerHTML = '';
    galeria.forEach((img, index) => {
      const mini = document.createElement('img');
      mini.src = img;
      mini.className = 'miniatura' + (index===0 ? ' ativa' : '');
      mini.alt = (livro.titulo || 'miniatura') + ' ' + (index+1);
      mini.addEventListener('click', () => { atual = index; atualizarImagem(); });
      miniaturasDiv.appendChild(mini);
    });
    atualizarImagem();

    // ========= INFO BOLACHAS =========
    const infoLivroDiv = document.getElementById('infoLivro');
    infoLivroDiv.innerHTML = '';
    const infoList = [
      { icone:'M6 4v16h12V4H6zm11 14H7V6h10v12z', texto: livro.genero || '' },
      { icone:'M12 2a10 10 0 100 20 10 10 0 000-20zm4.93 6h-3.14a17.48 17.48 0 00-1.58-3.7A8.03 8.03 0 0116.93 8z', texto: livro.idioma || '' },
      { icone:'M19 4H9a2 2 0 00-2 2v12a2 2 0 002 2h10v-2H9V6h10v12h2V6a2 2 0 00-2-2z', texto: livro.paginas ? (livro.paginas + ' p√°ginas') : '' },
      { icone:'M12 2a7 7 0 00-7 7c0 3.88 3.12 7 7 7s7-3.12 7-7a7 7 0 00-7-7z', texto: livro.peso || '' },
      { icone:'M12 4.5l1.94 3.94 4.35.63-3.15 3.07.74 4.32-3.88-2.04-3.88 2.04.74-4.32-3.15-3.07 4.35-.63L12 4.5z', texto: livro.acabamento || '' },
      { icone:'M6 4h12v16H6z', texto: livro.capaTipo || 'Capa dura' },
      { icone:'M18 6l-6 6-6-6-2 2 6 6-6 6 2 2 6-6 6 6 2-2-6-6 6-6z', texto: livro.corte || '' }
    ].filter(x => x.texto);

    infoList.forEach(info => {
      const item = document.createElement('div');
      item.className = 'item-info';
      const svg  = document.createElementNS('http://www.w3.org/2000/svg','svg');
      svg.setAttribute('class','icone-info');
      svg.setAttribute('viewBox','0 0 24 24');
      svg.setAttribute('fill','currentColor');
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('d', info.icone);
      svg.appendChild(path);
      const span = document.createElement('span');
      span.textContent = info.texto;
      item.append(svg, span);
      infoLivroDiv.appendChild(item);
    });

    // ========= UTIL (storage) =========
    function parseLS(key) {
      try { const raw = localStorage.getItem(key); if (!raw) return null; return JSON.parse(raw); }
      catch { return null; }
    }
    function getLSArrayFlexible(key) {
      const data = parseLS(key);
      if (Array.isArray(data)) return data;
      if (data && typeof data === 'object') return Object.values(data);
      return [];
    }
    function saveLS(key, list) { localStorage.setItem(key, JSON.stringify(list || [])); }

    function normalizeItem(it) {
      if (!it || it.id == null) return null;
      const valorStr = (String(it.valor ?? '').toString().replace(',', '.'));
      return {
        id: String(it.id),
        titulo: it.titulo || '',
        autor: it.autor || '',
        valor: Number(valorStr) || 0,
        imagem: it.imagem || ''
      };
    }
    function readFavsSafe() { return getLSArrayFlexible('favoritos').map(normalizeItem).filter(Boolean); }
    function writeFavsSafe(arr){ saveLS('favoritos', (arr || []).map(normalizeItem).filter(Boolean)); }
    function readCartSafe() { return getLSArrayFlexible('pedidos').map(normalizeItem).filter(Boolean); }
    function writeCartSafe(arr){ saveLS('pedidos', (arr || []).map(normalizeItem).filter(Boolean)); }

    // Toast (fallback r√°pido)
    if (!window.showToast) {
      (() => {
        const rootId = 'toast-root';
        window.showToast = function (text, opts = {}) {
          const { type = 'info', duration = 2600 } = opts;
          const msg = (text == null || String(text).trim() === '') ? 'A√ß√£o conclu√≠da.' : String(text);
          let root = document.getElementById(rootId);
          if (!root) {
            root = document.createElement('div'); root.id = rootId;
            Object.assign(root.style,{position:'fixed',zIndex:'9999',top:'16px',right:'16px',display:'flex',flexDirection:'column',gap:'10px',pointerEvents:'none'});
            document.body.appendChild(root);
          }
          const wrap = document.createElement('div');
          Object.assign(wrap.style,{
            pointerEvents:'auto',minWidth:'260px',maxWidth:'min(90vw,380px)',padding:'12px 14px',borderRadius:'12px',color:'#111',background:'#fff',
            boxShadow:'0 10px 30px rgba(0,0,0,.15)',display:'grid',gridTemplateColumns:'24px 1fr 24px',alignItems:'start',gap:'10px',
            opacity:'0',transform:'translateY(-10px)',transition:'opacity .18s ease, transform .18s ease',borderLeft:'6px solid #3b82f6'
          });
          wrap.innerHTML = `
            <div style="font-size:18px;line-height:1">‚ÑπÔ∏è</div>
            <div style="font:500 14px/1.35 system-ui;color:#111;">${msg}</div>
            <button type="button" aria-label="Fechar" style="border:0;background:transparent;font-size:18px;cursor:pointer;color:#333">√ó</button>
          `;
          const btnClose = wrap.querySelector('button');
          const close = () => { wrap.style.opacity='0'; wrap.style.transform='translateY(-10px)'; setTimeout(() => wrap.remove(), 180); };
          btnClose.addEventListener('click', close);
          document.getElementById(rootId).appendChild(wrap);
          requestAnimationFrame(() => { wrap.style.opacity='1'; wrap.style.transform='translateY(0)'; });
          setTimeout(close, duration);
        };
      })();
    }

    // ========= FAVORITOS & PEDIDOS =========
    const btnFav     = document.getElementById('btnFav');
    const btnCart    = document.getElementById('btnCart');
    const btnComprar = document.getElementById('btnComprar');

    function normalizarPrecoStr(p) {
      if (!p) return '';
      return String(p).replace(/[^\d,\.]/g,'').replace(/\./g,'').replace(',', '.');
    }

    function livroAtual() {
      const srcAtual = document.getElementById('imagem-grande')?.getAttribute('src') || (galeria[0] || '');
      const valorNum = Number(normalizarPrecoStr(livro.preco)) || Number(livro.valor || 0) || 0;
      return normalizeItem({
        id: livroId,
        titulo: livro.titulo || '',
        autor: livro.autor || '',
        valor: valorNum,
        imagem: srcAtual
      });
    }

    function isFav(id) { return readFavsSafe().some(x => String(x.id) === String(id)); }
    function fillHeart(el, on) { if (el) el.textContent = on ? '‚ù§Ô∏è' : 'ü§ç'; }

    function toggleFavorito() {
      const item = livroAtual();
      if (!item) return;
      let favs = readFavsSafe();
      if (favs.some(x => String(x.id) === item.id)) {
        favs = favs.filter(x => String(x.id) !== item.id);
        writeFavsSafe(favs);
        fillHeart(btnFav, false);
      } else {
        favs.push(item);
        writeFavsSafe(favs);
        fillHeart(btnFav, true);
      }
    }

    function addAoPedido() {
      const item = livroAtual();
      if (!item) return;
      let cart = readCartSafe();
      if (cart.some(x => String(x.id) === item.id)) {
        showToast('‚ö†Ô∏è Este livro j√° est√° nos pedidos.', { type: 'warning' });
        return;
      }
      cart.push(item);
      writeCartSafe(cart);
      showToast('üìö Livro adicionado aos pedidos!', { type: 'success' });
    }

    // Estado inicial do cora√ß√£o
    if (btnFav) fillHeart(btnFav, isFav(livroId));

    // Liga eventos
    if (btnFav)     btnFav.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); toggleFavorito(); });
    if (btnCart)    btnCart.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); addAoPedido(); });
    if (btnComprar) btnComprar.addEventListener('click', (e)=>{ e.preventDefault(); addAoPedido(); /* opcional: location.href='pedidos.html' */ });
  });
  </script>
</body>
</html>